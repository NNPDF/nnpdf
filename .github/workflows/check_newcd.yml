# A CI script with github workflow to test the new commondata
name: Test new commondata

on:
  push:
  workflow_dispatch:

jobs:
  test-commondata:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-tags: true
          fetch-depth: 0
      - name: Install NNPDF data package ğŸ
        run: pip install ./nnpdf_data/'[filter]'
      - name: Run the filters ğŸ“¦
        shell: bash -l {0}
        run: |
          here=$PWD
          readarray -d '' array < <(find ./nnpdf_data/nnpdf_data/commondata -name "filter.py" -print0)
          for datname in "${array[@]}"; do dirpath=${datname%/*}; cd $dirpath; python filter.py || exit $?; cd $here; done
      - name: Check for modified commondata files ğŸ›ï¸
        shell: bash -l {0}
        run: |
          if [[ -n "$(git diff --name-only)" ]]; then
            echo "Some of the commondata files have changed âŒ"
            git diff --name-only
            exit 1
          else
            echo "No modified commondata files âœ…"
          fi
