package:
    name: nnpdf
    version: "{{ GIT_DESCRIBE_TAG }}.{{ GIT_DESCRIBE_NUMBER }}+{{ GIT_DESCRIBE_HASH }}"

source:
    git_url: ../

requirements:
    build:
        - {{ compiler("cxx") }}
        - {{ compiler("c") }}
        - swig
        - cmake
        - pkg-config
        # See https://github.com/NNPDF/nnpdf/pull/1280
        - sysroot_linux-64==2.17 # [linux]
        - clang==14 # [osx]
        - cmake==3.26 # [osx]
    host:
        - lhapdf      # with python wrapper
        - sqlite
        - gsl         # Gsl doesn't link openblas on old debian 7
        - libarchive
        - yaml-cpp >=0.6.3
        - apfel >=3   # see https://github.com/scarrazza/apfel
        - python
        - numpy
        - poetry-core >=1.0.0
        - poetry-dynamic-versioning >=1.1.0
    run:
        - tensorflow >=2.10
        - psutil # to ensure n3fit affinity is with the right processors
        - blas==1.0 *mkl* # [osx] # Host's blas is mkl, force also runtime blas to be
        - hyperopt
        - seaborn
        - lhapdf
        - sqlite
        - gsl
        - numpy
        - libarchive
        - yaml-cpp >=0.6.3
        - apfel
        - pkg-config
        - python # requirements for validphys
        - reportengine ==0.30.28  # see https://github.com/NNPDF/reportengine
        - matplotlib >=3.3.0,<3.8  # see https://github.com/NNPDF/nnpdf/pull/1809
        - blessings >=1.7
        - scipy >=0.19.1
        - pandas
        - requests
        - prompt_toolkit
        - validobj
        - sphinx >=4.0.2 # documentation. Needs pinning becasue https://github.com/sphinx-doc/sphinx/issues/9216
        - recommonmark
        - sphinx_rtd_theme >0.5
        - sphinxcontrib-bibtex
        - pineappl >=0.6.2
        - eko >=0.14.1
        - fiatlux
        - frozendict  # needed for caching of data loading
        - curio >=1.0 # reportengine uses it but it's not in its dependencies

test:
    requires:
        - hypothesis
        - pytest
        - coverage
        - pytest-mpl

    source_files:
        - "*"

build:
    number: 0
    detect_binary_files_with_prefix: True
    # import CONDA_BUILD_SYSROOT from env variable for osx
    script_env:
      - CONDA_BUILD_SYSROOT # [osx]

about:
    home: https://nnpdf.mi.infn.it/
    license: SECRET
    summary: "NNPDF analysis framework"
